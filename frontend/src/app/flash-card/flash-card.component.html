<!-- Sélecteur de matière -->
<div class="flex flex-wrap gap-2 mb-6">
  <button
    *ngFor="let matiere of matieres"
    (click)="selectMatiere(matiere)"
    class="px-4 py-2 rounded-full text-sm font-medium capitalize transition-colors"
    [class.bg-indigo-600]="selectedMatiere === matiere"
    [class.text-white]="selectedMatiere === matiere"
    [class.bg-gray-200]="selectedMatiere !== matiere"
    [class.text-gray-700]="selectedMatiere !== matiere"
  >
    {{ matiere }}
  </button>
  <button (click)="createFlashCard()" class="bg-gradient-to-r from-green-400 to-green-500 px-4 py-2 rounded-full"> <!--ajouter une/des flash card-->
    Créer une flash-card
  </button>
</div>

<!-- Flash-cards de la matière sélectionnée -->
<ng-container *ngIf="showCard">
    <ng-container *ngIf="selectedMatiere; else aucuneSelection">
        <div *ngFor="let deck of decksActuels" class="mb-8">
            <h3 class="text-lg font-semibold text-gray-700 mb-3 capitalize">{{ deck.nom }}</h3>

            <div class="flex flex-wrap gap-4">
            <div
                *ngFor="let carte of deck.cartes"
                class="[perspective:1000px] w-64 h-40 cursor-pointer"
                (click)="carte.flipped = !carte.flipped"
            >
                <div
                class="relative w-full h-full transition-transform duration-700 [transform-style:preserve-3d]"
                [style.transform]="carte.flipped ? 'rotateY(180deg)' : 'rotateY(0deg)'"
                >
                <div class="absolute inset-0 bg-indigo-500 rounded-xl flex items-center justify-center p-4 [backface-visibility:hidden]">
                    <p class="text-white text-center font-semibold">{{ carte.question }}</p>
                </div>

                <div class="absolute inset-0 bg-green-500 rounded-xl flex items-center justify-center p-4 [backface-visibility:hidden] [transform:rotateY(180deg)]">
                    <p class="text-white text-center">{{ carte.reponse }}</p>
                </div>
                </div>
            </div>
            </div>
        </div>
    </ng-container>
</ng-container>


<ng-template #aucuneSelection>
  <p class="text-gray-400 text-center mt-12">Sélectionne une matière pour voir les flash-cards.</p>
</ng-template>


<!--Ajouter une flash-card-->
<ng-container *ngIf="showAddCard">
  <div class="max-w-xl mx-auto bg-white rounded-2xl shadow p-6">
    <h2 class="text-lg font-bold text-gray-800 mb-4">Créer une flash-card</h2>

    <!-- Messages -->
    <p *ngIf="successMessage" class="mb-3 text-green-600 text-sm font-medium">{{ successMessage }}</p>
    <p *ngIf="errorMessage" class="mb-3 text-red-500 text-sm font-medium">{{ errorMessage }}</p>

    <!-- Matière -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700 mb-1">Matière</label>
      <input [(ngModel)]="newMatiere" type="text" placeholder="ex: espagnol"
        class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400" />
    </div>

    <!-- Nom du deck -->
    <div class="mb-4">
      <label class="block text-sm font-medium text-gray-700 mb-1">Nom du deck</label>
      <input [(ngModel)]="newNom" type="text" placeholder="ex: vocabulaire"
        class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400" />
    </div>

    <!-- Cartes -->
    <div class="mb-4 space-y-3">
      <label class="block text-sm font-medium text-gray-700">Cartes</label>
      <div *ngFor="let carte of newCartes; let i = index" class="flex gap-2 items-start">
        <div class="flex-1 space-y-1">
          <input [(ngModel)]="carte.question" type="text" placeholder="Question"
            class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400" />
          <input [(ngModel)]="carte.reponse" type="text" placeholder="Réponse"
            class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-green-400" />
        </div>
        <button (click)="removeCarte(i)" class="mt-1 text-red-400 hover:text-red-600 text-lg font-bold" title="Supprimer">✕</button>
      </div>
    </div>

    <button (click)="addCarte()" class="w-full mb-4 border-2 border-dashed border-indigo-300 text-indigo-500 rounded-lg py-2 text-sm hover:bg-indigo-50 transition">
      + Ajouter une carte
    </button>

    <!-- Actions -->
    <div class="flex gap-3">
      <button (click)="submitFlashCard()" class="flex-1 bg-indigo-600 text-white rounded-lg py-2 text-sm font-medium hover:bg-indigo-700 transition">Enregistrer</button>
      <button (click)="cancelAdd()" class="flex-1 bg-gray-100 text-gray-700 rounded-lg py-2 text-sm font-medium hover:bg-gray-200 transition">Annuler</button>
    </div>
    <p class="text-xs text-gray-500 mt-2">Pourquoi on ne peut pas les générer automatiquement ? J'ai la flemme d'y mettre en place</p>
  </div>
</ng-container>